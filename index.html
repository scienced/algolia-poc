<!doctype html>
<html lang="en">
  <head>
    <title>Algolia Search - Colect POC</title>

    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.46/dist/instantsearch.production.min.js"></script>

    <script>
      var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights@2.2.3/dist/search-insights.min.js";

      !function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
      (e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
      i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
      }(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
    </script>


    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/instantsearch.css@7/themes/algolia-min.css"
    />

   <style type="text/css">
     /* The Modal (background) */
      .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }

      /* Modal Content/Box */
      .modal-content {
        background-color: #fefefe;
        margin: 30px auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        border-radius: 10px;
        width: 93%; /* Could be more or less, depending on screen size */
      }

      /* The Close Button */
      .close {
        position: absolute;
        right: 32px;
        top: 32px;
        width: 32px;
        height: 32px;
        opacity: 0.3;
      }
      .close:hover {
        opacity: 1;
      }
      .close:before, .close:after {
        position: absolute;
        left: 15px;
        content: ' ';
        height: 33px;
        width: 2px;
        background-color: #333;
      }
      .close:before {
        transform: rotate(45deg);
      }
      .close:after {
        transform: rotate(-45deg);
      }

        /* product card design */
        .card {
          max-width: 300px;
          margin: auto;
          text-align: center;
          font-family: arial;
        }

        .price  {
          color: grey;
          font-weight: 100;
            font-size: 12px;
        }

        a {
          text-decoration: none;
        }

        h1 {
          font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
            margin: 0;
            color: black;
        }

        /* override some algolia css */
        .ais-Hits-item, .ais-InfiniteHits-item, .ais-InfiniteResults-item, .ais-Results-item {
          margin-top: 1rem;
          margin-left: 1rem;
          padding: 1rem;
          width: calc(20% - 1rem);
          border: 1px solid #c4c8d8;
          box-shadow: 0 2px 5px 0 #e3e5ec;
      }

      mark {
        background-color: #e8033530;
      }

     .ais-QueryRuleCustomData {
       max-height: 343px;
    overflow: hidden;
    /* width: 100%; */
    margin-bottom: 1rem;
     }

    .ais-QueryRuleCustomData img {
    width: 100%;
    } 


    /* SIDE BAR CSS */
    .with-sidebar {
  display: flex;
  flex-wrap: wrap;
  gap: var(--s1);
}

.with-sidebar > :first-child {
  flex-grow: 1;
}

.with-sidebar > :last-child {
  flex-basis: 0;
  flex-grow: 999;
  min-inline-size: 50%;
}
  


   </style> 

  </head>
  <body onload="checkparas()">
    <button id="myBtn">Open search modal</button>

    <p>1. The search modal is based on the <strong>instantsearch.js</strong> library</p>

    This search currently supports:
    <ul>
      <li>Algolia Insights, sending view/click and conversion events</li>
      <li>Routing (good back from PDP experience)</li>
      <li>Facets</li>
      <li>Full size modal</li>
      <li>Banner support, see: <a href="?PL_TriumphTEST%5Bquery%5D=amour">example</a></li>
    </ul>

    Pending features:
    <ul>
      <li>No results screen (pending)</li>
      <li>Facets show more</li>
      <li>Integrate autocomplete.js library. See standalone <a href="auto.html">here</a></li>
    </ul>



     </ul> 
 
  </body>


<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="close"></div>
    <br>

<div id="searchbox"></div>
<br>


<div class="with-sidebar">
  <div><!-- sidebar -->

     <div id="stats"></div>
     <h3>Product Line</h3>
        <div id="categories-list"></div>

         <h3>Series</h3>
        <div id="series-list"></div>

        <h3>Status</h3>
        <div id="status-list"></div>

        <h3>Lifecycle</h3>
        <div id="lifecycle-list"></div>

        <h3>Color</h3>
        <div id="color-list"></div>

        <br>
        <div id="clear-refinements"></div>
      </div>
    <div><!-- non-sidebar -->
       <div id="banner"></div>
    <div id="hits"></div>
    </div>
  </div>
     
     
     

   

  </div>

</div>




    <script type="text/javascript">
      const searchClient = algoliasearch('E8HZJUFDQU', '2eab4588c570c21e4ef0e93c7483c45a');

      const search = instantsearch({
        indexName: 'PL_TriumphTEST',
        searchClient,
        routing: true,
      });


      search.addWidgets([
        instantsearch.widgets.searchBox({
          container: '#searchbox',

        }),

        instantsearch.widgets.stats({
          container: '#stats',
  
        }),

        instantsearch.widgets.queryRuleCustomData({
          container: '#banner',
          templates: {
            default: `
              {{#items}}
                <a href="{{link}}">
                <img src={{banner_image}} />
                </a>
              {{/items}}
            `,
          },
        }),


        instantsearch.widgets.hits({
          container: '#hits',
          templates: {
          item: (hit, bindEvent) =>  `
            <a href="${hit.link}" ${bindEvent('click', hit, 'pdp clicked')}>
            <div class="card">
              <img src="${hit.image_link}" style="max-width: 100%; max-height: 300px">
          
             <h1>${hit._highlightResult.title.value}</h1>
              
              <p class="price">${hit.objectID} - ${hit.colorCode}</p>
              <p class="price">WSP: ${hit.currencyCode} ${hit.wholesalePrice} - RSP: ${hit.currencyCode} ${hit.retailPrice}</p>
             
              

   

            </div>
            </a>
          `,
        },
        }),

         instantsearch.widgets.refinementList({
          container: '#status-list',
          attribute: 'status',
        }),
        instantsearch.widgets.refinementList({
          container: '#lifecycle-list',
          attribute: 'productGroupCode',
        }),
        instantsearch.widgets.refinementList({
          container: '#categories-list',
          attribute: 'categories',
        }),
        instantsearch.widgets.refinementList({
          container: '#series-list',
          attribute: 'userDefinedField2',
        }),
         instantsearch.widgets.refinementList({
          container: '#color-list',
          attribute: 'simpleColor',
        }),

        instantsearch.widgets.clearRefinements({
          container: '#clear-refinements',
        }),




      ]);

      search.use(instantsearch.middlewares.createInsightsMiddleware({
        insightsClient: window.aa,
      }));
      window.aa('setUserToken', 'my-user-token');


      search.start();

    </script>

    <script type="text/javascript">

      // Check if router has search query parameter, if so open model
      function checkparas() {
        const queryString = window.location.search
        const urlParams = new URLSearchParams(queryString)
        const searchState = urlParams.has('PL_TriumphTEST[query]')
        if (searchState) {
         modal.style.display = "block";
        }
      } 


      // Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";


}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
    </script>


</html>